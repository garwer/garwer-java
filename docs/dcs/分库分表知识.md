> 分库分表是为了解决数据量过大导致数据库性能降低的问题,将原来独立的数据库拆分成若干个数据库、将数据库大表分成若干个数据表,从而达到提升数据库性能的目的

分库分表的方式

```
垂直、水平分库
垂直、水平分表
```



垂直分表:将一个表按照字段分成多表,每个表存储一部分字段,可以将数据访问频率做分表

> 带来的好处
>
> 不同业务如果占用字段不同互不影响，比如列表展示和详情信息展示，避免io争抢减少锁表概率【大字段io低，因为数据量大需要较长获取时间、可能会跨页,单页默认16k】

同一个库中在同一个物理机，会争用同一个cpu、io资源、网络、连接数等



垂直分库:一般是按业务将表分库，每个库可以在不同服务上，专库专用

比如商品和店铺数据在多个库

> 带来的好处
>
> 解决业务耦合，业务清晰
>
> 一定提升了io能力和数据库连接数

但依然没解决单表数据量过大的问题



水平分库:

把同一个表数据按一定规则拆分(主键id hash)到不同的数据库中，每个库可以在不同服务器【水平是同表业务，表结构不变】





水平分表:与水平分库思路类似,但是目标为表,将一个表按某个规则入到不同表里(表结构相同)



### 分表分库带来的问题

##### 事务一致性问题



##### 跨节点关联查询

将原关联查询分为两次查询，第一次查询找出关联数据id,第二次查关联数据，最后拼接



##### 分页排序问题

从两个库查 查完再汇总



##### 主键冲突问题

分库无法使用自增主键，设计使用全局主键、避免跨库主键重复



##### 公共表问题

比如含字典id字段，存在不同库使用同一个公共表问题

```
在实际应用场景中、字典表一般比较小变动小，sharding-jdbc会帮忙在每个库创建字典表，如果字典表发生表动会做同步处理
```





## Sharding-jdbc

当当网开源的分布式数据库中间件

shardingSphere是一套开源的分布式数据库中间件解决方案组成的生态圈

由sharding-jdbc/sharding-proxy/sharding-slidecar组成

使用客户端直连数据库，兼容jdbc和各种orm框架

```
核心功能是数据分片(数据库和表做拆分)和读写分离,通过sharding-jdbc,应用可以透明(操作起来看起来像操作单个)使用已分库分表的数据源，而不关心数据源数量和数据如何分布
```

简化分库分表的操作



### 分片规则配置



#### 一些基本概念

##### 逻辑表

水平拆分数据表总称

##### 物理表

真实表

##### 绑定表

分片规则一致的主表和字表，不分会出现表查询笛卡尔积

![image-20210122020306512](../../../../Library/Application Support/typora-user-images/image-20210122020306512.png)

##### 广播表

所有分片数据源都有的表,如字典表



##### 分片算法

通过分片算法将数据分片



##### 分片建

根据分片字段，一般为主键



##### 自增主键策略

生成主键策略 如雪花



### 执行原理

![image-20210122020812094](../../../../Library/Application Support/typora-user-images/image-20210122020812094.png)